{
  "info": {
    "name": "CRM Multi-Agent API â€” Hackathon 2026",
    "_postman_id": "crm-multiagent-hackathon-2026",
    "description": "ColecciÃ³n completa para probar el sistema multi-agente CRM con LangGraph.\n\nFlujo recomendado:\n1. Ejecutar '0 Â· Login' en la carpeta Auth â†’ el JWT se guarda automÃ¡ticamente en {{jwt_token}}\n2. Ejecutar un request de la carpeta 'EscalaciÃ³n' â†’ captura automÃ¡tica del run_id\n3. Ir a 'Supervisor' â†’ Aprobar o Rechazar usando el run_id guardado\n\nVariables de colecciÃ³n requeridas:\n- base_url: URL del servidor (default: http://localhost:8000)\n- webhook_api_key: valor de WEBHOOK_API_KEY en tu .env\n- jwt_token: se llena automÃ¡ticamente al hacer login",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8000",
      "type": "string",
      "description": "URL base del servidor FastAPI"
    },
    {
      "key": "run_id",
      "value": "",
      "type": "string",
      "description": "Capturado automÃ¡ticamente al generar una escalaciÃ³n"
    },
    {
      "key": "jwt_token",
      "value": "",
      "type": "string",
      "description": "JWT del supervisor â€” se llena automÃ¡ticamente al ejecutar el request de Login"
    },
    {
      "key": "webhook_api_key",
      "value": "PEGA_AQUI_TU_WEBHOOK_API_KEY",
      "type": "string",
      "description": "Valor de WEBHOOK_API_KEY en el .env â€” requerido por el webhook endpoint"
    }
  ],
  "item": [
    {
      "name": "ğŸ” Auth",
      "description": "Login del supervisor. Ejecuta este request primero â€” el JWT se guarda automÃ¡ticamente en {{jwt_token}}.",
      "item": [
        {
          "name": "0 Â· Login supervisor",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "username", "value": "supervisor", "type": "text" },
                { "key": "password", "value": "admin", "type": "text", "description": "Cambia esto por tu contraseÃ±a real" }
              ]
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/login",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "login"]
            },
            "description": "AutenticaciÃ³n del supervisor. Usa form-data (no JSON). El token JWT se guarda automÃ¡ticamente en la variable {{jwt_token}}."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('access_token present', () => {",
                  "    const d = pm.response.json();",
                  "    pm.expect(d).to.have.property('access_token');",
                  "    pm.expect(d.token_type).to.equal('bearer');",
                  "    pm.collectionVariables.set('jwt_token', d.access_token);",
                  "    console.log('âœ” JWT saved to {{jwt_token}}');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "0b Â· Login invÃ¡lido â†’ 401",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "username", "value": "supervisor", "type": "text" },
                { "key": "password", "value": "wrong-password", "type": "text" }
              ]
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/login",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "login"]
            },
            "description": "Verifica que credenciales incorrectas devuelven 401."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 401 for wrong credentials', () => pm.response.to.have.status(401));",
                  "pm.test('detail field present', () => pm.expect(pm.response.json()).to.have.property('detail'));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "ğŸŸ¢ Health",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Endpoint pÃºblico â€” no requiere autenticaciÃ³n."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('status = healthy', () => {",
                  "    pm.expect(pm.response.json().status).to.equal('healthy');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "ğŸ”µ Webhook â€” Flujos AutomÃ¡ticos",
      "description": "Mensajes que el sistema procesa sin intervenciÃ³n humana.\nResultado esperado: status = 'processed'\nRequiere header X-Api-Key: {{webhook_api_key}}",
      "item": [
        {
          "name": "1 Â· Consulta general (EN)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}", "description": "API Key del bot CRM" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-001\",\n    \"message\": \"Hi, I would like to know the current status of my order #78432. Could you provide an update?\",\n    \"timestamp\": \"{{$isoTimestamp}}\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const d = pm.response.json();",
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('status = processed', () => pm.expect(d.status).to.equal('processed'));",
                  "pm.test('sentiment is neutral or positive', () => pm.expect(d.sentiment).to.be.oneOf(['neutral', 'positive']));",
                  "pm.test('execution_result exists', () => pm.expect(d.execution_result).to.not.be.null);",
                  "pm.test('no supervisor_note on auto cases', () => pm.expect(d.supervisor_note).to.be.null);",
                  "console.log('Response drafted:', d.execution_result);"
                ]
              }
            }
          ]
        },
        {
          "name": "2 Â· Consulta general (ES)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-002\",\n    \"message\": \"Hola, quisiera saber cuÃ¡ndo estarÃ¡ disponible el nuevo plan de facturaciÃ³n mensual para empresas medianas.\",\n    \"timestamp\": \"{{$isoTimestamp}}\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const d = pm.response.json();",
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('status = processed', () => pm.expect(d.status).to.equal('processed'));",
                  "pm.test('execution_result in Spanish', () => {",
                  "    const text = (d.execution_result || '').toLowerCase();",
                  "    const hasSpanish = ['su', 'hemos', 'usted', 'recibido', 'equipo', 'pronto'].some(w => text.includes(w));",
                  "    pm.expect(hasSpanish, 'Response should be in Spanish').to.be.true;",
                  "});",
                  "console.log('Respuesta generada:', d.execution_result);"
                ]
              }
            }
          ]
        },
        {
          "name": "3 Â· Solicitud de reembolso (neutral)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-003\",\n    \"message\": \"I need to process a refund for invoice INV-2026-0041. The product did not meet the agreed specifications.\",\n    \"timestamp\": \"{{$isoTimestamp}}\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const d = pm.response.json();",
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('proposed_action = process_refund', () => pm.expect(d.proposed_action).to.equal('process_refund'));",
                  "pm.test('status = processed', () => pm.expect(d.status).to.equal('processed'));",
                  "pm.test('execution_result mentions refund', () => {",
                  "    const text = (d.execution_result || '').toLowerCase();",
                  "    pm.expect(text).to.match(/refund|reembolso|processed|process/);",
                  "});",
                  "console.log('Refund response:', d.execution_result);"
                ]
              }
            }
          ]
        },
        {
          "name": "4 Â· Mensaje positivo â€” felicitaciÃ³n",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-004\",\n    \"message\": \"I just wanted to say that your support team was absolutely excellent. The issue was resolved in record time. Thank you!\",\n    \"timestamp\": \"{{$isoTimestamp}}\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const d = pm.response.json();",
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('sentiment = positive', () => pm.expect(d.sentiment).to.equal('positive'));",
                  "pm.test('status = processed', () => pm.expect(d.status).to.equal('processed'));",
                  "console.log('Response:', d.execution_result);"
                ]
              }
            }
          ]
        },
        {
          "name": "4b Â· Sin API Key â†’ 401",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-TEST\",\n    \"message\": \"Test without API key\",\n    \"timestamp\": \"{{$isoTimestamp}}\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            },
            "description": "Verifica que sin X-Api-Key el endpoint devuelve 401."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 401 without API key', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "ğŸ”´ Webhook â€” Flujos de EscalaciÃ³n",
      "description": "Mensajes que requieren aprobaciÃ³n humana.\nResultado esperado: status = 'pending_approval'\nEl run_id se guarda automÃ¡ticamente en {{run_id}}",
      "item": [
        {
          "name": "5 Â· Cliente furioso â€” daÃ±o en producto (EN) âš¡",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-005\",\n    \"message\": \"This is completely unacceptable! My shipment arrived destroyed for the second consecutive time. I am furious and I will escalate this directly to your CEO if this is not resolved today.\",\n    \"timestamp\": \"{{$isoTimestamp}}\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const d = pm.response.json();",
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('status = pending_approval', () => pm.expect(d.status).to.equal('pending_approval'));",
                  "pm.test('sentiment = negative', () => pm.expect(d.sentiment).to.equal('negative'));",
                  "pm.test('proposed_action = escalate_to_human', () => pm.expect(d.proposed_action).to.equal('escalate_to_human'));",
                  "pm.test('supervisor_note generated', () => pm.expect(d.supervisor_note).to.not.be.null);",
                  "if (d.run_id) {",
                  "    pm.collectionVariables.set('run_id', d.run_id);",
                  "    console.log('âœ” run_id saved:', d.run_id);",
                  "}",
                  "console.log('Supervisor note:', d.supervisor_note);"
                ]
              }
            }
          ]
        },
        {
          "name": "6 Â· Cliente enojado â€” reembolso urgente (ES) âš¡",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-006\",\n    \"message\": \"Esto es un fraude. Me cobraron dos veces por el mismo servicio y nadie me responde. Exijo una devoluciÃ³n inmediata o presentarÃ© una queja formal ante el regulador.\",\n    \"timestamp\": \"{{$isoTimestamp}}\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const d = pm.response.json();",
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('status = pending_approval', () => pm.expect(d.status).to.equal('pending_approval'));",
                  "pm.test('sentiment = negative', () => pm.expect(d.sentiment).to.equal('negative'));",
                  "pm.test('supervisor_note generated', () => pm.expect(d.supervisor_note).to.not.be.null);",
                  "if (d.run_id) {",
                  "    pm.collectionVariables.set('run_id', d.run_id);",
                  "    console.log('âœ” run_id saved:', d.run_id);",
                  "}",
                  "console.log('Nota supervisiÃ³n:', d.supervisor_note);"
                ]
              }
            }
          ]
        },
        {
          "name": "7 Â· SLA Breach â€” sin respuesta hace 5 horas âš¡",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-007\",\n    \"message\": \"I submitted a support request 5 hours ago and have not received any response. My service is currently down and this is impacting our business operations.\",\n    \"timestamp\": \"{{old_timestamp}}\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const fiveHoursAgo = new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString();",
                  "pm.collectionVariables.set('old_timestamp', fiveHoursAgo);",
                  "console.log('Timestamp used (5h ago):', fiveHoursAgo);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const d = pm.response.json();",
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('sla_breached = true', () => pm.expect(d.sla_breached).to.be.true);",
                  "pm.test('status = pending_approval', () => pm.expect(d.status).to.equal('pending_approval'));",
                  "pm.test('supervisor_note generated', () => pm.expect(d.supervisor_note).to.not.be.null);",
                  "if (d.run_id) {",
                  "    pm.collectionVariables.set('run_id', d.run_id);",
                  "    console.log('âœ” run_id saved:', d.run_id);",
                  "}",
                  "console.log('SLA note:', d.supervisor_note);"
                ]
              }
            }
          ]
        },
        {
          "name": "8 Â· SLA Breach + Sentimiento negativo combinado âš¡",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-008\",\n    \"message\": \"Terrible service. I opened a ticket 6 hours ago about a critical outage affecting all our users and nobody has bothered to respond. This is absolutely unacceptable.\",\n    \"timestamp\": \"{{old_timestamp}}\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const sixHoursAgo = new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString();",
                  "pm.collectionVariables.set('old_timestamp', sixHoursAgo);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const d = pm.response.json();",
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('sla_breached = true', () => pm.expect(d.sla_breached).to.be.true);",
                  "pm.test('sentiment = negative', () => pm.expect(d.sentiment).to.equal('negative'));",
                  "pm.test('status = pending_approval', () => pm.expect(d.status).to.equal('pending_approval'));",
                  "if (d.run_id) pm.collectionVariables.set('run_id', d.run_id);"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "ğŸŸ¡ Supervisor â€” Human-in-the-Loop",
      "description": "Requiere JWT en Authorization: Bearer {{jwt_token}}.\nEjecuta el request de Login primero para obtener el token.",
      "item": [
        {
          "name": "9 Â· Listar aprobaciones pendientes",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{jwt_token}}", "description": "JWT del supervisor" }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/supervisor/pending",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "supervisor", "pending"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('response is an array', () => pm.expect(pm.response.json()).to.be.an('array'));",
                  "const items = pm.response.json();",
                  "console.log(`Pending approvals: ${items.length}`);",
                  "items.forEach(item => {",
                  "    console.log(`  [${item.run_id.slice(0,8)}...] client=${item.client_id} | sentiment=${item.sentiment} | sla=${item.sla_breached}`);",
                  "    console.log(`  Note: ${item.supervisor_note}`);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "9b Â· Sin JWT â†’ 401",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/supervisor/pending",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "supervisor", "pending"]
            },
            "description": "Verifica que sin JWT el endpoint devuelve 401."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 401 without JWT', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ]
        },
        {
          "name": "10 Â· Aprobar acciÃ³n âœ…",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{jwt_token}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"run_id\": \"{{run_id}}\",\n    \"approved\": true,\n    \"reason\": \"Verified high-priority client. Proceed with immediate resolution and assign to senior support team.\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/supervisor/decide",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "supervisor", "decide"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const d = pm.response.json();",
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('status = approved_and_executed', () => pm.expect(d.status).to.equal('approved_and_executed'));",
                  "pm.test('execution_result generated by LLM', () => pm.expect(d.execution_result).to.not.be.null);",
                  "console.log('Client response sent:', d.execution_result);",
                  "pm.collectionVariables.set('run_id', '');"
                ]
              }
            }
          ]
        },
        {
          "name": "11 Â· Rechazar acciÃ³n âŒ",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{jwt_token}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"run_id\": \"{{run_id}}\",\n    \"approved\": false,\n    \"reason\": \"Duplicate case â€” already being handled directly by the account manager.\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/supervisor/decide",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "supervisor", "decide"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const d = pm.response.json();",
                  "pm.test('HTTP 200', () => pm.response.to.have.status(200));",
                  "pm.test('status = rejected', () => pm.expect(d.status).to.equal('rejected'));",
                  "pm.test('execution_result is null on rejection', () => pm.expect(d.execution_result).to.be.null);",
                  "pm.collectionVariables.set('run_id', '');"
                ]
              }
            }
          ]
        },
        {
          "name": "12 Â· run_id inexistente â†’ 404",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{jwt_token}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"run_id\": \"00000000-0000-0000-0000-000000000000\",\n    \"approved\": true\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/supervisor/decide",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "supervisor", "decide"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 404 for unknown run_id', () => pm.response.to.have.status(404));",
                  "pm.test('error detail present', () => pm.expect(pm.response.json()).to.have.property('detail'));"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "âš« Validaciones de Entrada",
      "description": "Pruebas de validaciÃ³n Pydantic â€” todos deben retornar HTTP 422",
      "item": [
        {
          "name": "13 Â· Sin timestamp â†’ 422",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-ERR-001\",\n    \"message\": \"Missing timestamp field\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 422 Unprocessable Entity', () => pm.response.to.have.status(422));",
                  "const errors = pm.response.json().detail;",
                  "pm.test('timestamp field flagged', () => {",
                  "    const fields = errors.map(e => e.loc.join('.'));",
                  "    pm.expect(fields.some(f => f.includes('timestamp'))).to.be.true;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "14 Â· client_id vacÃ­o â†’ 422",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"\",\n    \"message\": \"Empty client_id\",\n    \"timestamp\": \"{{$isoTimestamp}}\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 422 for empty client_id', () => pm.response.to.have.status(422));"
                ]
              }
            }
          ]
        },
        {
          "name": "15 Â· Timestamp con formato invÃ¡lido â†’ 422",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Api-Key", "value": "{{webhook_api_key}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"client_id\": \"CRM-ERR-003\",\n    \"message\": \"Bad timestamp format\",\n    \"timestamp\": \"26-02-2026 10:00\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/webhook/messages",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "webhook", "messages"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('HTTP 422 for invalid timestamp format', () => pm.response.to.have.status(422));"
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}
